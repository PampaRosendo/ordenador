<script>
const categorias = {
  "Resources/Textures": ["resource", "texture"],
  "Maps/Locations": ["map", "location"],
  "Transportation": ["vehicle", "car", "transport"],
  "Framework/API/Tweak mods": ["api", "framework", "lib"],
  "Code-only mods": ["tweak", "patch", "balance"],
  "Clothing": ["clothing", "outfit", "apparel"],
  "Interface": ["hud", "ui", "interface"],
  "Localization": ["translation", "localization", "lang"],
  "Other mods": []
};

function detectarCategoria(nombre) {
  const lname = nombre.toLowerCase();
  for (let cat in categorias) {
    if (categorias[cat].some(palabra => lname.includes(palabra))) {
      return cat;
    }
  }
  return "Other mods";
}

function procesar() {
  const texto = document.getElementById('inputMods').value;
  const lineas = texto.split(/\n/).map(e => e.trim());

  let modLine = lineas.find(line => line.toLowerCase().startsWith("mods="));
  let workshopLine = lineas.find(line => line.toLowerCase().startsWith("workshopitems="));

  if (!modLine && !workshopLine) {
    document.getElementById('resultado').innerText = "No se encontraron líneas Mods= o WorkshopItems=";
    return;
  }

  const modList = modLine ? modLine.split("=")[1].split(";").map(e => e.trim()).filter(Boolean) : [];
  const workshopList = workshopLine ? workshopLine.split("=")[1].split(";").map(e => e.trim()).filter(Boolean) : [];

  const mods = [];

  // Si las listas tienen la misma cantidad, las alineamos por índice
  if (modList.length === workshopList.length) {
    for (let i = 0; i < modList.length; i++) {
      mods.push({
        modid: modList[i],
        workshop: workshopList[i],
        categoria: detectarCategoria(modList[i])
      });
    }
  } else {
    // Si no, asignamos WorkshopID: Desconocido
    modList.forEach(mod => {
      mods.push({
        modid: mod,
        workshop: "Desconocido",
        categoria: detectarCategoria(mod)
      });
    });
  }

  // Agrupar por categoría
  const porCategoria = {};
  mods.forEach(mod => {
    if (!porCategoria[mod.categoria]) porCategoria[mod.categoria] = [];
    porCategoria[mod.categoria].push(mod);
  });

  // Generar salida
  let salida = "";
  for (let cat of Object.keys(categorias)) {
    if (porCategoria[cat]) {
      salida += `== ${cat} ==\n`;
      porCategoria[cat].forEach(mod => {
        salida += `ModID: ${mod.modid} | WorkshopID: ${mod.workshop}\n`;
      });
      salida += "\n";
    }
  }

  document.getElementById('resultado').innerText = salida.trim();
}

function copiar() {
  const res = document.getElementById('resultado').innerText;
  navigator.clipboard.writeText(res).then(() => {
    alert("¡Copiado al portapapeles!");
  });
}

document.getElementById("fileInput").addEventListener("change", function() {
  const file = this.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    document.getElementById('inputMods').value = e.target.result;
  };
  reader.readAsText(file);
});
</script>

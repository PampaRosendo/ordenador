<script>
const categorias = {
  "Resources/Textures": ["resource", "texture"],
  "Maps/Locations": ["map", "location"],
  "Transportation": ["vehicle", "car", "transport"],
  "Framework/API/Tweak mods": ["api", "framework", "lib"],
  "Code-only mods": ["tweak", "patch", "balance"],
  "Clothing": ["clothing", "outfit", "apparel"],
  "Interface": ["hud", "ui", "interface"],
  "Localization": ["translation", "localization", "lang"],
  "Other mods": []
};

function detectarCategoria(nombre) {
  const lname = nombre.toLowerCase();
  for (let cat in categorias) {
    if (categorias[cat].some(palabra => lname.includes(palabra))) {
      return cat;
    }
  }
  return "Other mods";
}

function extraerModData(texto) {
  let modLine = texto.match(/Mods=([^\n\r]*)/i);
  let workshopLine = texto.match(/WorkshopItems=([^\n\r]*)/i);

  const modList = modLine ? modLine[1].split(";").map(e => e.trim()).filter(Boolean) : [];
  const workshopList = workshopLine ? workshopLine[1].split(";").map(e => e.trim()).filter(Boolean) : [];

  const mods = [];

  // Si coinciden en cantidad, se emparejan
  if (modList.length === workshopList.length) {
    for (let i = 0; i < modList.length; i++) {
      mods.push({
        modid: modList[i],
        workshop: workshopList[i],
        categoria: detectarCategoria(modList[i])
      });
    }
  } else {
    // Si no coinciden, poner Workshop como "Desconocido"
    modList.forEach(mod => {
      mods.push({
        modid: mod,
        workshop: "Desconocido",
        categoria: detectarCategoria(mod)
      });
    });
  }

  return mods;
}

function procesar() {
  const texto = document.getElementById('inputMods').value;
  const mods = extraerModData(texto);

  const porCategoria = {};
  mods.forEach(mod => {
    if (!porCategoria[mod.categoria]) porCategoria[mod.categoria] = [];
    porCategoria[mod.categoria].push(mod);
  });

  let salida = "";
  for (let cat of Object.keys(categorias)) {
    if (porCategoria[cat]) {
      salida += `== ${cat} ==\n`;
      porCategoria[cat].forEach(mod => {
        salida += `ModID: ${mod.modid} | WorkshopID: ${mod.workshop}\n`;
      });
      salida += "\n";
    }
  }

  document.getElementById('resultado').innerText = salida.trim();
}

function copiar() {
  const res = document.getElementById('resultado').innerText;
  navigator.clipboard.writeText(res).then(() => {
    alert("Â¡Copiado al portapapeles!");
  });
}

// Detectar carga de archivo INI
document.getElementById("fileInput").addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    const contenido = e.target.result;
    document.getElementById('inputMods').value = contenido;
    procesar(); // Auto procesar tras subir archivo
  };
  reader.readAsText(file);
});
</script>
